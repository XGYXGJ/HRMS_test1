<div class="container-fluid p-4">
    <div class="card shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-primary">
                <i class="bi bi-file-person me-2"></i> 新建员工档案
            </h5>
            <div>
                <a onclick="loadContent('/hr/personnel/list', this)" class="btn btn-secondary btn-sm">
                    <i class="bi bi-arrow-left me-1"></i> 返回列表
                </a>
            </div>
        </div>
        <div class="card-body">
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i><span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <form method="post" th:action="@{/hr/personnel/new}" class="w-75 mx-auto">
                <h5 class="mb-3 text-primary"><i class="bi bi-info-circle me-2"></i>基本信息</h5>
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-person me-1"></i>姓名 <span class="text-danger">*</span></label>
                    <input name="name" class="form-control" required/>
                </div>
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-gender-ambiguous me-1"></i>性别</label>
                    <select name="gender" class="form-select">
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-credit-card me-1"></i>身份证号</label>
                    <input name="idNumber" id="idNumber" class="form-control"/>
                    <small id="idNumber-msg" class="form-text text-muted"></small>
                </div>
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-telephone me-1"></i>手机号</label>
                    <input name="phoneNumber" id="phoneNumber" class="form-control"/>
                    <small id="phoneNumber-msg" class="form-text text-muted"></small>
                </div>
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-house me-1"></i>地址</label>
                    <input name="address" class="form-control"/>
                </div>

                <hr class="my-4">
                <h5 class="mb-3 text-primary"><i class="bi bi-briefcase me-2"></i>职位分配</h5>
                <div class="alert alert-info">
                    <i class="bi bi-building me-1"></i>新员工将自动归属到您所在的部门：<strong th:text="${session.user.l3OrgId}"></strong>
                </div>

                <div class="mb-3">
                    <label for="positionId" class="form-label"><i class="bi bi-check-circle me-1"></i>分配职位 <span class="text-danger">*</span></label>
                    <select id="positionId" name="positionId" class="form-select" required>
                        <option value="">-- 请选择职位 --</option>
                        <option th:each="pos : ${positions}" th:value="${pos.positionId}" th:text="${pos.positionName}"></option>
                    </select>
                </div>

                <button type="submit" class="btn btn-success">
                    <i class="bi bi-check-lg me-1"></i>确认创建
                </button>
            </form>
        </div>
    </div>
</div>
<script>
    (function() {
        const idInput = document.getElementById('idNumber');
        const phoneInput = document.getElementById('phoneNumber');
        const idMsg = document.getElementById('idNumber-msg');
        const phoneMsg = document.getElementById('phoneNumber-msg');

        const idTargetLength = 18;
        const phoneTargetLength = 11;

        function updateMessage(input, msgElement, targetLength) {
            if (!input || !msgElement) return;
            const currentLength = input.value.length;
            const remaining = targetLength - currentLength;

            if (currentLength === 0) {
                msgElement.textContent = '';
                msgElement.className = 'form-text text-muted';
            } else if (remaining > 0) {
                msgElement.textContent = `还差 ${remaining} 位。`;
                msgElement.className = 'form-text text-warning';
            } else if (remaining === 0) {
                msgElement.textContent = '位数正确。';
                msgElement.className = 'form-text text-success';
            } else {
                msgElement.textContent = `超出了 ${-remaining} 位。`;
                msgElement.className = 'form-text text-danger';
            }
        }

        if(idInput) {
            idInput.addEventListener('input', () => updateMessage(idInput, idMsg, idTargetLength));
            updateMessage(idInput, idMsg, idTargetLength);
        }
        if(phoneInput) {
            phoneInput.addEventListener('input', () => updateMessage(phoneInput, phoneMsg, phoneTargetLength));
            updateMessage(phoneInput, phoneMsg, phoneTargetLength);
        }
    })();
</script>
