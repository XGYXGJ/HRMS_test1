<div class="container-fluid">
    <div class="d-flex justify-content-between mb-3 align-items-center">
        <h3>薪资发放历史</h3>

        <!-- 搜索表单 + 刷新按钮 -->
        <div class="d-flex align-items-center gap-2">
            <form class="d-flex" action="/salary/register/list" method="get">
                <input type="search"
                       name="registerCode"
                       class="form-control form-control-sm me-2"
                       placeholder="根据单号模糊搜索 (例如: PAY20251211)"
                       th:value="${registerCode}">
                <button type="submit" class="btn btn-primary btn-sm">搜索</button>
            </form>

            <button onclick="loadContent('/salary/register/list')" class="btn btn-outline-secondary btn-sm">刷新</button>
        </div>
    </div>

    <!-- 这两行你原来就有，保留不影响 Modal（只是会多显示一条 alert） -->
    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead class="table-dark">
                <tr>
                    <th>单号</th>
                    <th>所属月份</th>
                    <th>总人数</th>
                    <th>发放总金额</th>
                    <th>审核状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="reg : ${registers}">
                    <td th:text="${reg.registerCode}">PAY2025121101</td>
                    <td th:text="${reg.payDate}">2023-10-01</td>
                    <td th:text="${reg.totalPeople}">10</td>
                    <td th:text="${reg.totalAmount}">150000.00</td>
                    <td>
                        <span th:if="${reg.auditStatus == 'Draft'}" class="badge bg-secondary">草稿</span>
                        <span th:if="${reg.auditStatus == 'Pending'}" class="badge bg-warning text-dark">待审核</span>
                        <span th:if="${reg.auditStatus == 'Approved'}" class="badge bg-success">已发放</span>
                        <span th:if="${reg.auditStatus == 'Rejected'}" class="badge bg-danger">已驳回</span>
                    </td>
                    <td>
                        <!-- 草稿 & 驳回：进入可编辑草稿详情（可以录入KPI） -->
                        <button th:if="${reg.auditStatus == 'Draft' or reg.auditStatus == 'Rejected'}"
                                th:onclick="'loadContent(\'/salary/register/draft-detail/' + ${reg.registerId} + '\')'"
                                class="btn btn-sm btn-warning">
                            录入绩效 / 确认
                        </button>

                        <!-- 待审核 & 已发放：进入只读详情 -->
                        <button th:if="${reg.auditStatus == 'Pending' or reg.auditStatus == 'Approved'}"
                                th:onclick="'loadContent(\'/salary/register/detail/' + ${reg.registerId} + '\')'"
                                class="btn btn-sm btn-primary">
                            查看明细
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- =================== Modal + 自动弹窗（放在文件最底部） =================== -->

    <!-- Bootstrap Modal 提示框 -->
    <div class="modal fade" id="toastModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="toastTitle">提示</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="toastBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">知道了</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 自动弹窗脚本：error/msg 有值就弹 -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        const err = /*[[${error}]]*/ null;
        const msg = /*[[${msg}]]*/ null;

        const text = err || msg;
        if (text) {
            document.getElementById('toastBody').innerText = text;
            document.getElementById('toastTitle').innerText = err ? "操作失败" : "操作成功";
            const modal = new bootstrap.Modal(document.getElementById('toastModal'));
            modal.show();
        }
        /*]]>*/
    </script>
</div>