<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.hrms.mapper.PersonnelFileMapper">

    <!--
        目标：联表查询档案信息和机构名称。
        注意：PersonnelService.listFiles 中使用了多个字段别名进行安全访问，我们需要确保这些字段都返回。
    -->
    <select id="selectFilesWithOrgName" resultType="java.util.Map">
        SELECT
        pf.File_ID AS fileId,
        pf.Archive_No AS archiveNo,
        pf.User_ID AS userId,
        pf.Name AS name,
        pf.Phone_Number AS phoneNumber,
        pf.Audit_Status AS auditStatus,
        pf.L3_Org_ID AS L3_Org_ID,  <!-- L3_Org_ID 是 PersonnelService 中权限检查所必需的 -->
        o.Org_Name AS orgName      <!-- orgName 是列表展示所必需的 -->
        FROM
        T_Personnel_File pf
        LEFT JOIN
        T_Organization o ON pf.L3_Org_ID = o.Org_ID
        WHERE
        pf.Is_Deleted = 0
        ORDER BY
        pf.Creation_Time DESC
    </select>

</mapper>
